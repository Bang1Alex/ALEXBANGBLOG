<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fabric.js 路径映射示例</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>

</head>

<body>
    <div class="container">
        <h1>Fabric.js 路径映射示例</h1>
        <p>展示如何将图形2上的路径映射到图形1上</p>

        <div class="canvas-container">
            <canvas id="canvas" width="1000" height="700"></canvas>
        </div>

        <div class="controls">
            <h2>控制面板</h2>
            <div class="info">
                <strong>说明：</strong><br>
                1. 蓝色半透明三角形是图形1<br>
                2. 红色半透明三角形是图形2（图形1的1.5倍缩放）<br>
                3. 绿色路径是在图形2上绘制的原始路径<br>
                4. 紫色路径是映射到图形1上的路径（缩小1.5倍）
            </div>

            <div>
                <button onclick="addOriginalShapes()">添加原始图形</button>
                <button onclick="addOriginalPath()">添加原始路径</button>
                <button onclick="addMappedPath()">添加映射路径</button>
                <button onclick="clearCanvas()">清空画布</button>
                <button onclick="showAll()">显示全部</button>
            </div>

            <div class="info">
                <strong>计算详情：</strong><br>
                <div id="calculationDetails"></div>
            </div>
        </div>
    </div>

    <script>
        // 初始化画布
        const canvas = new fabric.Canvas('canvas', {
            backgroundColor: '#f8f9fa'
        });

        // 定义颜色
        const paperColor = 'rgba(0, 0, 255, 0.3)';

        // 原始路径数据（在图形2上绘制的路径）
        const pathInTriangle2 = "M 392.0969323678552,238.99178634146125 392.0975567622535,238.854187500183 L 392.0975567622535 238.854187500183 L 392.09942994544843 238.71596462787855 L 392.1025519174399 238.5771177245478 L 392.1069226782281 238.4376467901909 L 392.1125422278129 238.29755182480784 L 392.1194105661943 238.1568328283985 L 392.1275276933724 238.01548980096305 L 392.13689360934694 237.87352274250125 L 392.1475083141182 237.73093165301339 L 392.15937180768606 237.58771653249926 L 392.17248409005066 237.44387738095892 L 392.1868451612118 237.29941419839244 L 392.2024550211694 237.1543269847996 L 392.21931366992374 237.0086157401807 L 392.23742110747474 236.86228046453553 L 392.25677733382236 236.71532115786417 L 392.2773823489665 236.56773782016663 L 392.2992361529073 236.41953045144285 L 392.32233874564474 236.27069905169284 L 392.3466901271788 236.1212436209167 L 392.37260249470864 235.9708521436012 L 392.40038804543343 235.81921260423331 L 392.43004677935306 235.66632500281298 L 392.4615786964677 235.51218933934027 L 392.4949837967772 235.35680561381514 L 392.53026208028166 235.20017382623757 L 392.56741354698113 235.04229397660765 L 392.60643819687544 234.88316606492532 L 392.64733602996466 234.72279009119052 L 392.69010704624884 234.5611660554033 L 392.7347512457279 234.39829395756374 L 392.78126862840196 234.2341737976717 L 392.8296591942709 234.0688055757273 L 392.8799229433348 233.90218929173048 L 392.9320598755936 233.73432494568124 L 392.9860699910474 233.5652125375796 L 393.04195328969604 233.39485206742552 L 393.0997097715396 233.22324353521904 L 393.15933943657814 233.05038694096018 L 393.22084228481157 232.87628228464888 L 393.28421831623996 232.70092956628517 L 393.34946753086325 232.5243287858691 L 393.41658992868145 232.3464799434005 L 393.4855855096946 232.16738303887962 L 393.55645427390266 231.98703807230626 L 393.62919622130573 231.8054450436805 L 393.7038113519037 231.62260395300237 L 393.78029966569653 231.43851480027175 L 393.8586611626843 231.25317758548877 L 393.93889584286705 231.06659230865338 L 394.0210037062447 230.87875896976558 L 394.10498475281736 230.68967756882537 L 394.19083898258475 230.4993481058327 L 394.27856639554716 230.3077705807877 L 394.3681669917045 230.11494499369024 L 394.4596407710569 229.9208713445404 L 394.5529877336041 229.72554963333812 L 394.64820787934616 229.5289798600834 L 394.74530120828325 229.33116202477632 L 394.84426772041525 229.13209612741682 L 394.9441708241447 228.9336542610835 L 395.0440739278742 228.73770851885504 L 395.14397703160364 228.54425890073136 L 395.2438801353331 228.35330540671254 L 395.34378323906253 228.16484803679853 L 395.443686342792 227.97888679098935 L 395.5435894465214 227.79542166928496 L 395.6434925502509 227.61445267168543 L 395.7433956539804 227.4359797981907 L 395.8432987577098 227.26000304880077 L 395.94320186143926 227.0865224235157 L 396.0431049651687 226.91553792233543 L 396.1430080688982 226.74704954525998 L 396.2429111726276 226.58105729228936 L 396.3428142763571 226.41756116342356 L 396.4427173800865 226.25656115866258 L 396.542620483816 226.09805727800642 L 396.6425235875455 225.9420495214551 L 396.74242669127494 225.78853788900858 L 396.8423297950044 225.6375223806669 L 396.94223289873383 225.48900299643 L 397.04213600246334 225.342979736298 L 397.1420391061927 225.19945260027072 L 397.24194220992223 225.05842158834835 L 397.3418453136516 224.91988670053072 L 397.4417484173811 224.78384793681798 L 397.5416515211106 224.65030529721002 L 397.64155462484 224.5192587817069 L 397.7414577285695 224.39070839030862 L 397.84136083229896 224.26465412301513 L 397.94126393602846 224.1410959798265 L 398.04116703975797 224.0200339607427 L 398.1410701434873 223.9014680657636 L 398.24097324721674 223.7853982948894 L 398.34087635094625 223.67182464812007 L 398.4407794546757 223.56074712545555 L 398.54068255840525 223.4521657268958 L 398.64058566213464 223.34608045244087 L 398.7404887658641 223.24249130209077 L 398.84039186959353 223.14139827584552 L 398.9406071705222 223.04155331165265 L 399.04144686584914 222.9417083474598 L 399.14291095557434 222.84186338326697 L 399.2449994396979 222.7420184190741 L 399.3477123182197 222.64217345488123 L 399.4510495911398 222.54232849068836 L 399.5550112584583 222.44248352649555 L 399.6595973201751 222.34263856230268 L 399.76480777629024 222.2427935981098 L 399.8706426268036 222.14294863391694 L 399.97710187171526 222.0431036697241 L 400.08418551102534 221.94325870553126 L 400.1918935447336 221.8434137413384 L 400.3002259728403 221.74356877714553 L 400.40918279534515 221.64372381295271 L 400.5187640122484 221.54387884875985 L 400.62896962355 221.44403388456698 L 400.7397996292499 221.3441889203741 L 400.85125402934807 221.24434395618127 L 400.96333282384455 221.1444989919884 L 401.07603601273934 221.04465402779556 L 401.1893635960325 220.94480906360272 L 401.3033155737238 220.84496409940982 L 401.4178919458136 220.74511913521698 L 401.5330927123016 220.64527417102414 L 401.64891787318794 220.54542920683127 L 401.76536742847264 220.44558424263843 L 401.8824413781555 220.34573927844554 L 402.00013972223684 220.24589431425272 L 402.1184624607164 220.14604935005985 L 402.23740959359435 220.04620438586701 L 402.35698112087056 219.94635942167417 L 402.47717704254495 219.84651445748125 L 402.59799735861776 219.7466694932884 L 402.719442069089 219.6468245290956 L 402.8415111739584 219.54697956490276 L 402.96420467322616 219.4471346007099 L 403.0875225668921 219.34728963651702 L 403.2114648549565 219.24744467232415 L 403.33603153741916 219.1475997081313 L 403.46122261428013 219.04744272842535 L 403.58703808553946 218.94666171769322 L 403.71347795119704 218.84525667593482 L 403.8405422112529 218.74322760315025 L 403.96823086570714 218.6405744993395 L 404.0965439145596 218.53729736450248 L 404.2254813578105 218.4333961986393 L 404.35504319545964 218.32887100174992 L 404.4852294275071 218.2237217738343 L 404.6160400539528 218.1179485148925 L 404.74747507479685 218.0115512249245 L 404.8795344900393 217.90452990393027 L 405.01221829967994 217.79688455190984 L 405.14552650371894 217.68861516886324 L 405.27945910215624 217.57972175479037 L 405.4140160949919 217.47020430969135 L 405.54919748222585 217.36006283356613 L 405.685003263858 217.24929732641465 L 405.82143343988855 217.137907788237 L 405.9584880103174 217.02589421903315 L 406.09616697514457 216.91325661880308 L 406.2344703343701 216.79999498754682 L 406.37339808799373 216.68610932526428 L 406.5129502360159 216.57159963195565 L 406.65312677843633 216.45646590762075 L 406.79392771525505 216.34070815225965 L 406.9353530464721 216.2243263658724 L 407.07740277208734 216.10732054845883 L 407.220076892101 215.9896907000192 L 407.36337540651294 215.87143682055324 L 407.5072983153232 215.75255891006114 L 407.6518456185318 215.63305696854286 L 407.7970173161386 215.51293099599823 L 407.94281340814376 215.3921809924275 L 408.08923389454725 215.2708069578306 L 408.23627877534915 215.14880889220748 L 408.3839480505492 215.02618679555812 L 408.53224172014757 214.90294066788252 L 408.6811597841443 214.77907050918077 L 408.83070224253936 214.65457631945281 L 408.981493489731 214.53008212972483 L 409.13415792011756 214.4062119710231 L 409.28869553369907 214.28296584334754 L 409.44510633047554 214.1603437466982 L 409.60339031044685 214.03834568107504 L 409.76354747361313 213.9169716464781 L 409.92557781997436 213.79622164290737 L 410.08948134953056 213.67609567036286 L 410.2552580622816 213.55659372884452 L 410.4229079582276 213.4377158183524 L 410.59243103736856 213.3194619388865 L 410.76382729970436 213.20183209044677 L 410.9370967452351 213.0848262730333 L 411.11223937396085 212.96844448664598 L 411.2892551858815 212.8526867312849 L 411.468144180997 212.73755300695 L 411.6489063593075 212.62304331364135 L 411.8315417208129 212.50915765135883 L 412.0160502655133 212.39589602010255 L 412.2024319934086 212.28325841987254 L 412.3906869044987 212.17124485066864 L 412.5808149987839 212.05985531249104 L 412.7728162762639 211.94908980533953 L 412.9666907369389 211.8389483292143 L 413.1624383808088 211.72943088411526 L 413.36005920787363 211.62053747004242 L 413.5595532181335 211.51226808699585 L 413.760920411588 211.4046227349754 L 413.96416078823773 211.29760141398117 L 414.1692743480823 211.19120412401315 L 414.37626109112176 211.08543086507137 L 414.5851210173562 210.98028163715583 L 414.7958541267854 210.87575644026634 L 415.0084604194097 210.77185527440315 L 415.2229398952289 210.6685781395662 L 415.439292554243 210.5659250357554 L 415.6575183964521 210.46389596297084 L 415.87761742185603 210.36249092121247 L 416.0995896304549 210.26170991048028 L 416.3234350222487 210.16155293077435 L 416.54696821684337 210.06233199760769 L 416.76800383384483 209.96435912649346 L 416.986541873253 209.86763431743162 L 417.202582335068 209.77215757042222 L 417.4161252192896 209.6779288854652 L 417.62717052591813 209.5849482625606 L 417.83571825495335 209.49321570170844 L 418.04176840639536 209.40273120290868 L 418.2453209802442 209.31349476616128 L 418.44637597649967 209.22550639146635 L 418.64493339516196 209.13876607882378 L 418.84099323623104 209.05327382823367 L 419.03455549970687 208.96902963969592 L 419.2256201855895 208.88603351321063 L 419.41418729387874 208.80428544877773 L 419.6002568245749 208.72378544639724 L 419.7838287776778 208.64453350606917 L 419.96490315318744 208.5665296277935 L 420.14347995110387 208.48977381157025 L 420.31955917142704 208.4142660573994 L 420.49314081415696 208.34000636528094 L 420.66422487929367 208.26699473521495 L 420.83281136683706 208.1952311672013 L 420.99890027678737 208.1247156612401 L 421.1624916091443 208.05544821733133 L 421.323585363908 207.98742883547496 L 421.4821815410786 207.92065751567097 L 421.63828014065587 207.8551342579194 L 421.7918811626399 207.79085906222025 L 421.94298460703067 207.7278319285735 L 422.0915904738283 207.66605285697918 L 422.23769876303265 207.6055218474373 L 422.3813094746436 207.54623889994772 L 422.52242260866154 207.48820401451061 L 422.6610381650862 207.43141719112597 L 422.79715614391756 207.3758784297937 L 422.93077654515577 207.32158773051387 L 423.0618993688006 207.26854509328638 L 423.19052461485234 207.21675051811133 L 423.31665228331076 207.16620400498869 L 423.4415311629726 207.11628152289228 L 423.6912889222962 207.0164365586994 L 423.81616780195804 206.96651407660295 L 423.9410466816199 206.91659159450654 L 424.0659255612817 206.86666911241008 L 424.1908044409435 206.81674663031367 L 424.3156833206054 206.76682414821727 L 424.4405622002672 206.71690166612083 L 424.565441079929 206.6669791840244 L 424.69031995959085 206.617056701928 L 424.8151988392526 206.56713421983153 L 424.9400777189145 206.51721173773512 L 425.18983547823814 206.41736677354226 L 425.3147143578999 206.36744429144585 L 425.4395932375618 206.3175218093494 L 425.56447211722354 206.26759932725298 L 425.6893509968854 206.21767684515655 L 425.81422987654724 206.1677543630601 L 425.93910875620907 206.1178318809637 L 426.06398763587094 206.0679093988673 L 426.1888665155327 206.01798691677084 L 426.3137453951946 205.9680644346744 L 426.43862427485635 205.91814195257797 L 426.56350315451823 205.86821947048156 L 426.6883820341801 205.81829698838513 L 426.81326091384176 205.7683745062887 L 426.9381397935037 205.7184520241923 L 427.0630186731655 205.66852954209583 L 427.31277643248916 205.568684577903 L 427.4376553121509 205.51876209580655 L 427.5625341918128 205.46883961371012 L 427.68741307147457 205.4189171316137 L 427.81229195113644 205.36899464951728 L 427.9371708307983 205.31907216742087 L 428.06204971046003 205.2691496853244 L 428.18692859012185 205.21922720322797 L 428.31180746978373 205.16930472113157 L 428.43855953264045 205.11875820800893 L 428.5690579618871 205.0669636328339 L 428.70330275752355 205.01392099560644 L 428.84129391954986 204.95963029632657 L 428.983031447966 204.9040915349943 L 429.12851534277206 204.8473047116096 L 429.2777456039679 204.78926982617253 L 429.43072223155366 204.729986878683 L 429.5874452255293 204.66945586914107 L 429.74791458589465 204.6076767975468 L 429.91213031265 204.54464966390003 L 430.0800924057951 204.48037446820086 L 430.25180086533015 204.4148512104493 L 430.42725569125497 204.34807989064535 L 430.60645688356976 204.28006050878895 L 430.7894044422743 204.2107930648802 L 430.97609836736865 204.14027755891897 L 431.166538658853 204.06851399090533 L 431.3607253167271 203.99550236083934 L 431.5586583409911 203.92124266872088 L 431.76033773164494 203.84573491455004 L 431.9657634886887 203.7689790983268 L 432.17493561212217 203.69097522005112 L 432.38785410194566 203.61172327972304 L 432.60451895815885 203.53122327734255 L 432.82493018076195 203.44947521290965 L 433.049087769755 203.36647908642433 L 433.27699172513775 203.2822348978866 L 433.50864204691044 203.1967426472965 L 433.744038735073 203.11000233465396 L 433.9831817896254 203.022013959959 L 434.22607121056774 202.93277752321166 L 434.47270699789965 202.84229302441182 L 434.72308915162165 202.75056046355965 L 434.9772176717335 202.65757984065507 L 435.2350925582352 202.56335115569806 L 435.4967138111267 202.46787440868866 L 435.76208143040805 202.37114959962682 L 436.0311954160793 202.27317672851257 L 436.30405576814036 202.17395579534593 L 436.5775405145998 202.07504687769236 L 436.84852768346593 201.9780100531175 L 437.1170172747388 201.88284532162115 L 437.3830092884185 201.78955268320345 L 437.64650372450495 201.69813213786435 L 437.9075005829981 201.6085836856039 L 438.16599986389815 201.52090732642205 L 438.4220015672049 201.4351030603188 L 438.67550569291836 201.3511708872942 L 438.9265122410386 201.26911080734817 L 439.17502121156565 201.1889228204808 L 439.42103260449943 201.11060692669201 L 439.66454641984 201.03416312598188 L 439.9055626575873 200.95959141835033 L 440.14408131774144 200.8868918037974 L 440.38010240030223 200.8160642823231 L 440.6136259052698 200.7471088539274 L 440.8446518326442 200.68002551861034 L 441.07318018242535 200.61481427637185 L 441.2992109546133 200.55147512721203 L 441.5227441492079 200.4900080711308 L 441.7437797662094 200.4304131081282 L 441.9623178056175 200.37269023820417 L 442.1783582674325 200.31683946135882 L 442.3919011516542 200.26286077759204 L 442.60294645828264 200.21075418690393 L 442.811494187318 200.1605196892944 L 443.0175443387599 200.11215728476344 L 443.1584194111148 200.07998217704653 L 420.6156239061669 273.6576083650023 L 420.51936537888594 273.5824501550497 L 420.4194622751565 273.50319821472164 L 420.31955917142704 273.4226982123412 L 420.2196560676976 273.34095014790825 L 420.11975296396815 273.25795402142296 L 420.01984986023865 273.17370983288515 L 419.9199467565092 273.0882175822951 L 419.8200436527798 273.0014772696525 L 419.7201405490503 272.9134888949576 L 419.6202374453209 272.82425245821025 L 419.5203343415913 272.7337679594104 L 419.4204312378619 272.6420353985582 L 419.3205281341325 272.54905477565364 L 419.22062503040297 272.4548260906967 L 419.1207219266736 272.35934934368726 L 419.0208188229441 272.26262453462544 L 418.92091571921463 272.16465166351117 L 418.8210126154852 272.06543073034453 L 418.72142170895484 271.9652737506386 L 418.6224551968229 271.86449273990644 L 418.5241130790892 271.763087698148 L 418.4263953557538 271.66105862536347 L 418.3293020268168 271.5584055215527 L 418.232833092278 271.45512838671567 L 418.13698855213755 271.3512272208525 L 418.04176840639536 271.24670202396317 L 417.94717265505153 271.14155279604756 L 417.85320129810606 271.03577953710567 L 417.7598543355589 270.9293822471377 L 417.66713176740996 270.82236092614346 L 417.5750335936593 270.71471557412303 L 417.48355981430706 270.60644619107643 L 417.3927104293531 270.4975527770036 L 417.30248543879736 270.3880353319046 L 417.21288484264005 270.2778938557793 L 417.123908640881 270.1671283486279 L 417.0355568335202 270.05573881045024 L 416.9478294205578 269.94372524124634 L 416.8607264019937 269.83108764101627 L 416.77424777782795 269.71782600976 L 416.68839354806033 269.60394034747753 L 416.60316371269124 269.48943065416887 L 416.51855827172034 269.374296929834 L 416.4345772251478 269.25853917447284 L 416.3512205729735 269.1421573880856 L 416.2684883151975 269.02515157067205 L 416.18638045181984 268.9075217222324 L 416.10489698284056 268.78926784276644 L 416.0240379082595 268.67038993227436 L 415.9438032280769 268.55088799075605 L 415.8641929422923 268.43076201821145 L 415.7852070509062 268.31001201464073 L 415.70684555391847 268.1886379800438 L 415.629108451329 268.0666399144207 L 415.55199574313787 267.94401781777134 L 415.47550742934493 267.82077169009574 L 415.3996435099503 267.69690153139396 L 415.32440398495413 267.572407341666 L 415.24916445995785 267.44791315193805 L 415.17330054056333 267.3240429932363 L 415.0968122267705 267.20079686556073 L 415.0196995185793 267.07817476891137 L 414.9419624159898 266.95617670328824 L 414.86360091900195 266.8348026686913 L 414.7846150276159 266.71405266512056 L 414.70500474183154 266.593926692576 L 414.6247700616488 266.4744247510577 L 414.54391098706776 266.3555468405656 L 414.4624275180884 266.2372929610997 L 414.3803196547108 266.11966311265996 L 414.2975873969348 266.0026572952465 L 414.2142307447605 265.88627550885917 L 414.130249698188 265.7705177534981 L 414.0456442572171 265.6553840291632 L 413.9604144218479 265.5408743358545 L 413.87456019208037 265.426988673572 L 413.78808156791456 265.3137270423158 L 413.70097854935045 265.20108944208573 L 413.61325113638804 265.08907587288184 L 413.52489932902733 264.97768633470423 L 413.43592312726815 264.86692082755275 L 413.3463225311109 264.7567793514275 L 413.2560975405552 264.6472619063285 L 413.16524815560126 264.53836849225564 L 413.07377437624905 264.43009910920904 L 412.9816762024983 264.32245375718855 L 412.8889536343495 264.2154324361944 L 412.79560667180226 264.10903514622635 L 412.7016353148568 264.00326188728457 L 412.60703956351296 263.898112659369 L 412.5118194177707 263.79358746247954 L 412.41597487763033 263.68968629661634 L 412.31950594309154 263.5864091617794 L 412.2224126141545 263.48375605796866 L 412.1246948908191 263.38172698518406 L 412.0263527730854 263.28032194342563 L 411.92738626095337 263.1795409326935 L 411.82779535442313 263.07938395298754 L 411.7278922506936 262.9795389887947 L 411.6279891469642 262.87969402460186 L 411.5280860432348 262.779849060409 L 411.4281829395053 262.6800040962161 L 411.2283767320464 262.4803141678304 L 411.12847362831695 262.3804692036376 L 411.0285705245875 262.2806242394447 L 410.8287643171285 262.08093431105897 L 410.7288612133991 261.98108934686616 L 410.6289581096696 261.8812443826733 L 410.5290550059402 261.7813994184804 L 410.4291519022107 261.6815544542876 L 410.2293456947518 261.48186452590187 L 410.1294425910223 261.382019561709 L 410.0295394872929 261.2821745975162 L 409.92963638356343 261.18232963332326 L 409.829733279834 261.08248466913045 L 409.7298301761045 260.9826397049376 L 409.6299270723751 260.88279474074477 L 409.53002396864554 260.78294977655185 L 409.43012086491615 260.68310481235903 L 409.23031465745714 260.4834148839733 L 409.1304115537278 260.3835699197805 L 409.03050844999825 260.28372495558756 L 408.9306053462688 260.1838799913948 L 408.83070224253936 260.08403502720194 L 408.73079913880997 259.98419006300907 L 408.6308960350806 259.88434509881625 L 408.5309929313509 259.78450013462333 L 408.4310898276215 259.68465517043046 L 408.33118672389213 259.58481020623765 L 408.2312836201627 259.4849652420448 L 408.13138051643324 259.38512027785197 L 408.03147741270374 259.28527531365904 L 407.9315743089742 259.18543034946623 L 407.8316712052448 259.08558538527336 L 407.73145590431614 258.9860524365936 L 407.6306162089893 258.8871435189401 L 407.52915211926404 258.7888586323127 L 407.4270636351405 258.6911977767116 L 407.3243507566186 258.5941609521367 L 407.2210134836984 258.4977481585879 L 407.11705181638 258.4019593960654 L 407.01246575466325 258.3067946645691 L 406.90725529854814 258.212253964099 L 406.8014204480347 258.11833729465513 L 406.69496120312306 258.02504465623736 L 406.58787756381304 257.9323760488459 L 406.4801695301047 257.8403314724806 L 406.37183710199804 257.74891092714154 L 406.2628802794931 257.65811441282864 L 406.1532990625899 257.567941929542 L 406.0430934512883 257.4783934772815 L 405.93226344558843 257.38946905604723 L 405.82080904549025 257.3011686658392 L 405.70873025099377 257.2134923066574 L 405.5960270620989 257.1264399785017 L 405.48269947880596 257.0400116813723 L 405.3687475011144 256.954207415269 L 405.2541711290247 256.869027180192 L 405.1389703625367 256.78447097614117 L 405.0231452016504 256.70053880311656 L 404.9066956463658 256.6172306611181 L 404.78962169668273 256.53454655014593 L 404.6719233526015 256.4524864701999 L 404.55360061412193 256.37105042128013 L 404.4346534812441 256.2902384033865 L 404.315081953968 256.21005041651915 L 404.1948860322933 256.1304864606779 L 404.0740657162205 256.05154653586294 L 403.9526210057494 255.9732306420742 L 403.83055190088 255.89553877931166 L 403.70785840161227 255.81847094757532 L 403.58454050794614 255.74202714686513 L 403.46059821988183 255.66620737718117 L 403.33603153741916 255.59101163852344 L 403.21115265775734 255.51550388435257 L 403.0862737780956 255.43874806812934 L 402.9613948984337 255.36074418985368 L 402.8365160187719 255.2814922495256 L 402.71163713911005 255.2009922471451 L 402.5867582594482 255.11924418271218 L 402.4618793797864 255.0362480562269 L 402.33700050012465 254.95200386768917 L 402.21212162046277 254.86651161709904 L 402.087242740801 254.77977130445646 L 401.9623638611391 254.69178292976153 L 401.8374849814773 254.60254649301416 L 401.7126061018155 254.5120619942144 L 401.5877272221536 254.4203294333622 L 401.46284834249184 254.32734881045764 L 401.33796946283 254.2331201255006 L 401.2130905831682 254.1376433784912 L 401.0882117035064 254.04091856942935 L 400.96333282384455 253.9429456983151 L 400.83845394418273 253.84372476514847 L 400.7135750645209 253.74325576992942 L 400.5886961848591 253.641538712658 L 400.4638173051972 253.53857359333404 L 400.33893842553545 253.43436041195775 L 400.2140595458736 253.32889916852906 L 400.0891806662118 253.22218986304796 L 399.96430178655 253.11423249551444 L 399.8394229068881 253.00502706592846 L 399.71454402722634 252.89457357429015 L 399.58966514756446 252.7828720205994 L 399.4647862679027 252.66992240485624 L 399.33990738824093 252.5557247270607 L 399.215028508579 252.44027898721265 L 399.0901496289172 252.32358518531223 L 398.96527074925535 252.20564332135945 L 398.84039186959353 252.08645339535425 L 398.71551298993177 251.9660154072966 L 398.5906341102699 251.84432935718652 L 398.465755230608 251.72139524502407 L 398.34087635094625 251.59721307080923 L 398.2166218656827 251.47240686556813 L 398.09361616921586 251.3476006603271 L 397.97185926154555 251.22279445508602 L 397.85135114267194 251.09798824984495 L 397.7320918125949 250.9731820446039 L 397.61408127131443 250.8483758393628 L 397.49731951883064 250.72356963412176 L 397.3818065551435 250.5987634288807 L 397.26754238025285 250.47395722363962 L 397.1545269941589 250.34915101839852 L 397.0427603968616 250.22434481315747 L 396.9322425883609 250.09953860791637 L 396.82297356865683 249.97473240267533 L 396.7149533377493 249.84992619743426 L 396.6081818956385 249.72511999219319 L 396.5026592423242 249.6003137869521 L 396.39838537780656 249.47550758171104 L 396.2953603020856 249.35070137646997 L 396.19358401516126 249.2258951712289 L 396.09305651703346 249.10108896598786 L 395.99377780770226 248.97628276074676 L 395.89574788716783 248.85147655550574 L 395.7989667554299 248.72667035026458 L 395.70343441248855 248.60186414502357 L 395.60915085834387 248.47705793978247 L 395.51611609299584 248.3522517345414 L 395.4243301164444 248.22744552930038 L 395.3337929286896 248.10263932405925 L 395.24450452973133 247.9778331188182 L 395.15646491956977 247.8530269135771 L 395.06967409820487 247.7282207083361 L 394.9841320656366 247.60341450309505 L 394.8998388218647 247.47860829785392 L 394.8167943668896 247.35380209261282 L 394.7349987007112 247.22899588737178 L 394.65445182332934 247.10418968213074 L 394.575153734744 246.9793834768897 L 394.4971044349554 246.85457727164857 L 394.42030392396333 246.7297710664075 L 394.34475220176796 246.60496486116645 L 394.2704492683692 246.48015865592538 L 394.1973951237671 246.35535245068434 L 394.12558976796146 246.23054624544326 L 394.05503320095255 246.10574004020216 L 393.9857254227402 245.98093383496112 L 393.9176664333245 245.85612762972002 L 393.85085623270544 245.731321424479 L 393.785294820883 245.6065152192379 L 393.72098219785715 245.48170901399683 L 393.6579183636279 245.35690280875576 L 393.59610331819533 245.23209660351472 L 393.53553706155935 245.10729039827362 L 393.47621959372 244.98248419303258 L 393.4181509146772 244.85767798779148 L 393.36133102443114 244.7328717825504 L 393.3057599229816 244.60806557730933 L 393.2514376103287 244.4832593720683 L 393.19836408647245 244.35845316682725 L 393.1465393514128 244.23364696158615 L 393.09596340514975 244.10884075634507 L 393.0466362476833 243.984034551104 L 392.99855787901356 243.85922834586296 L 392.9517282991403 243.73442214062186 L 392.90614750806384 243.60961593538082 L 392.8618155057838 243.48480973013974 L 392.81873229230047 243.36000352489867 L 392.77689786761385 243.23519731965763 L 392.7363122317237 243.11039111441653 L 392.69697538463026 242.9855849091755 L 392.65888732633334 242.86077870393441 L 392.62204805683314 242.73597249869334 L 392.5864575761296 242.6111662934523 L 392.55211588422253 242.48636008821117 L 392.51902298111213 242.3615538829701 L 392.48717886679833 242.23674767772906 L 392.45658354128125 242.111941472488 L 392.4272370045607 241.98713526724694 L 392.39913925663683 241.86232906200587 L 392.3722902975095 241.73752285676477 L 392.3466901271788 241.61271665152373 L 392.32233874564474 241.48759843076954 L 392.2992361529073 241.3618561789892 L 392.2773823489665 241.23548989618257 L 392.25677733382236 241.10849958234982 L 392.23742110747474 240.98088523749084 L 392.21931366992374 240.8526468616056 L 392.2024550211694 240.72378445469423 L 392.1868451612118 240.5942980167566 L 392.17248409005066 240.4641875477928 L 392.15937180768606 240.33345304780278 L 392.1475083141182 240.20209451678653 L 392.13689360934694 240.0701119547441 L 392.1275276933724 239.93750536167548 L 392.1194105661943 239.8042747375806 L 392.1125422278129 239.6704200824596 L 392.1069226782281 239.53594139631235 L 392.10255191744 239.40083867913887 L 392.09942994544843 239.2651119309392 L 392.0975567622535 239.12876115171335 L 392.0969323678552 238.99178634146125Z"

        // 计算中心点
        const centerX = 500; // (400 + 600) / 2
        const centerY = 350; // (250 + 450) / 2

        // 存储图形引用
        let triangle1, triangle2, originalPath, mappedPath;

        // 函数：添加原始图形（三角形1和三角形2）
        function addOriginalShapes() {
            // 清空画布
            canvas.clear();

            // 创建三角形1（蓝色半透明）
            triangle1 = new fabric.Path(`M 200 50 L 300 50 L 360 -30 L 400 250 Z`, {
                fill: paperColor,
                stroke: 'blue',
                strokeWidth: 2,
                selectable: false,
                originX: "center",
                originY: "center",
                erasable: false,
                name: '三角形1'
            });

            // 设置三角形1的位置
            // triangle1.left = centerX;
            // triangle1.top = centerY;
            triangle1.setCoords();

            // 创建三角形2（红色半透明，1.5倍缩放）
            triangle2 = new fabric.Path(`M 200 50 L 300 50 L 360 -30 L 400 250 Z`, {
                fill: 'rgba(255, 0, 0, 0.3)',

                selectable: false,
                originX: "center",
                originY: "center",
                erasable: false,

                scaleX: 1.5,
                scaleY: 1.5,
                angle: 30,
                name: '三角形2'
            });
            const trianglePath3 = new fabric.Path("M 271.7723345923796 21.401911202145243 L 374.63241067663307 83.20648019135172 L 477.570595589111 21.53209258251934 L 374.4111023299971 433.06352388579523 Z", {
                fill: "deepskyblue",  // 半透明蓝色
                selectable: false,
                // originX: "center",
                // originY: "center",
                // erasable: false,
                // mode: "rect",
                // scaleX: 1.5,
                // scaleY: 1.5,
                // angle: 31,
            });
            //   canvas.add(trianglePath3);
            // 设置三角形2的位置（与三角形1中心对齐）
            // triangle2.left = centerX;
            // triangle2.top = centerY;
            triangle2.setCoords();

            // 添加到画布
            canvas.add(triangle1);
            canvas.add(triangle2);

            // // 添加中心点标记
            // const centerDot = new fabric.Circle({
            //     radius: 5,
            //     fill: 'green',
            //     left: centerX,
            //     top: centerY,
            //     originX: 'center',
            //     originY: 'center',
            //     selectable: false
            // });
            // canvas.add(centerDot);

            // // 添加文本标注
            // const text1 = new fabric.Text('三角形1', {
            //     left: centerX - 50,
            //     top: centerY - 100,
            //     fontSize: 16,
            //     fill: 'blue'
            // });

            // const text2 = new fabric.Text('三角形2 (1.5x)', {
            //     left: centerX + 50,
            //     top: centerY + 100,
            //     fontSize: 16,
            //     fill: 'red'
            // });

            // canvas.add(text1);
            // canvas.add(text2);

            canvas.renderAll();

            updateCalculationDetails('已添加原始图形：三角形1（蓝色）和三角形2（红色，1.5倍缩放）');
        }
        function mapPathToTriangle1(pathData, sourceObj, targetObj) {
            // === 1️⃣ 获取两个图形的变换矩阵 ===
            const sourceMatrix = sourceObj.calcTransformMatrix();
            const targetMatrix = targetObj.calcTransformMatrix();
            const inverseSourceMatrix = fabric.util.invertTransform(sourceMatrix);

            // === 2️⃣ 解析路径指令 ===
            const commands = pathData.split(/(?=[A-Z])/);
            let result = '';

            commands.forEach(command => {
                if (!command.trim()) return;

                const type = command[0];
                const nums = command.substring(1).trim().split(/[\s,]+/).map(Number);
                result += type + ' ';

                for (let i = 0; i < nums.length; i += 2) {
                    if (i + 1 < nums.length) {
                        const x = nums[i];
                        const y = nums[i + 1];

                        // === 3️⃣ 将全局坐标转为图形2的局部坐标 ===
                        const localPoint = fabric.util.transformPoint(new fabric.Point(x, y), inverseSourceMatrix);

                        // === 4️⃣ 将局部坐标从图形2映射到图形1坐标系 ===
                        const mappedPoint = fabric.util.transformPoint(localPoint, targetMatrix);

                        result += mappedPoint.x.toFixed(2) + ' ' + mappedPoint.y.toFixed(2) + ' ';
                    }
                }

                result = result.trim() + ' ';
            });

            return result.trim();
        }

        // function mapPathToTriangle1(pathData, sourceObj, targetObj) {
        //     // === 1️⃣ 获取中心与缩放 ===
        //     const scale = sourceObj.scaleX || 1; // 假设等比缩放
        //     const sourceCenter = sourceObj.getCenterPoint(); // 平移+origin考虑在内
        //     const targetCenter = targetObj.getCenterPoint();

        //     // === 2️⃣ 分解路径指令 ===
        //     const commands = pathData.split(/(?=[A-Z])/);
        //     let result = '';

        //     // === 3️⃣ 遍历每个路径命令 ===
        //     commands.forEach(command => {
        //         if (!command.trim()) return;

        //         const type = command[0];
        //         const nums = command.substring(1).trim().split(/[\s,]+/).map(Number);
        //         result += type + ' ';

        //         // === 4️⃣ 处理坐标点 ===
        //         for (let i = 0; i < nums.length; i += 2) {
        //             if (i + 1 < nums.length) {
        //                 const x = nums[i];
        //                 const y = nums[i + 1];

        //                 // Step 1: 从全局坐标 → 相对于图形2中心的坐标
        //                 const relX = x - sourceCenter.x;
        //                 const relY = y - sourceCenter.y;

        //                 // Step 2: 逆缩放回原比例
        //                 const mappedRelX = relX / scale;
        //                 const mappedRelY = relY / scale;

        //                 // Step 3: 加上图形1中心，得到最终映射点
        //                 const mappedX = targetCenter.x + mappedRelX;
        //                 const mappedY = targetCenter.y + mappedRelY;

        //                 result += mappedX.toFixed(2) + ' ' + mappedY.toFixed(2) + ' ';
        //             }
        //         }

        //         result = result.trim() + ' ';
        //     });

        //     return result.trim();
        // }


        // 函数：添加原始路径（在图形2上）
        function addOriginalPath() {
            if (!triangle2) {
                alert('请先添加原始图形！');
                return;
            }

            // 创建原始路径（在图形2上）
            originalPath = new fabric.Path(pathInTriangle2, {
                stroke: 'green',
                strokeWidth: 1,
                fill: '',
                selectable: false,
                originX: "center",
                originY: "center",
                erasable: false,
                name: '原始路径（在三角形2上）'
            });

            canvas.add(originalPath);
            canvas.bringToFront(originalPath);

            // 添加文本标注
            const text = new fabric.Text('原始路径', {
                left: 700,
                top: 300,
                fontSize: 16,
                fill: 'green'
            });
            canvas.add(text);

            canvas.renderAll();

            updateCalculationDetails('已添加原始路径（绿色），该路径是在三角形2上绘制的。');
        }

        // 函数：添加映射路径（到图形1上）
        function addMappedPath() {
            if (!triangle1) {
                alert('请先添加原始图形！');
                return;
            }


            const mappedPathData = mapPathToTriangle1(pathInTriangle2, triangle2, triangle1);
            mappedPath = new fabric.Path(mappedPathData, {
                stroke: 'purple',
                strokeWidth: 1,
                fill: '',
                selectable: false,
                originX: "center",
                originY: "center"
            });
            canvas.add(mappedPath);
            canvas.bringToFront(mappedPath);
            // 添加文本标注
            const text = new fabric.Text('映射路径', {
                left: 550,
                top: 200,
                fontSize: 16,
                fill: 'purple'
            });
            canvas.add(text);

            canvas.renderAll();

            // 显示映射计算的详细信息
            const details = `
                <strong>映射计算详情：</strong><br>
                - 中心点坐标: (${centerX}, ${centerY})<br>
                - 缩放比例: 1.5倍（从三角形2到三角形1）<br>
                - 映射公式: x1 = ${centerX} + (x2 - ${centerX}) / 1.5<br>
                - 映射公式: y1 = ${centerY} + (y2 - ${centerY}) / 1.5<br>
                - 示例: 点(660.59, 291.77) → 点(${(centerX + (660.5885236407738 - centerX) / 1.5).toFixed(2)}, ${(centerY + (291.77216941839913 - centerY) / 1.5).toFixed(2)})
            `;
            updateCalculationDetails('已添加映射路径（紫色），该路径是从三角形2映射到三角形1上的。' + details);
        }

        // 函数：显示所有元素
        function showAll() {
            addOriginalShapes();
            addOriginalPath();
            addMappedPath();
            updateCalculationDetails('已显示所有图形和路径。');
        }

        // 函数：清空画布
        function clearCanvas() {
            canvas.clear();
            canvas.backgroundColor = '#f8f9fa';
            canvas.renderAll();
            updateCalculationDetails('画布已清空。');
        }

        // 函数：更新计算详情显示
        function updateCalculationDetails(message) {
            document.getElementById('calculationDetails').innerHTML = message;
        }

        // 页面加载时自动添加图形
        window.onload = function () {
            addOriginalShapes();
            setTimeout(addOriginalPath, 500);
            setTimeout(addMappedPath, 1000);
        };
    </script>
</body>

</html>